#!/bin/sh

# 增加额外本地域名配置文件
for file in /etc/hosts.d/*; do
    if test -f "${file}"; then
        cat "${file}" >> /etc/hosts
    fi
done

# 处理Kubernetes环境变量问题（某些Drone变量没有被正确注入到环境变量中）
kubernetesEnv=/run/drone/env
newEnv=drone.env
if [ -f ${kubernetesEnv} ]; then
    cp ${kubernetesEnv} ${newEnv}
    sed -i 's/\//_/g;s/\./_/g' ${newEnv}
    export "$(< ${newEnv} xargs)"
    rm -f ${newEnv}
fi

# 执行程序
/bin/git
